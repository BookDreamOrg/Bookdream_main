<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
			
<mapper namespace="PayDAO">

	<resultMap type="pay" id="payList">
		<result property="pay_no" column="PAY_NO" />
		<result property="pay_date" column="PAY_DATE" />
		<result property="pay_method" column="PAY_METHOD" />
		<result property="user_no" column="USER_NO" />			
	</resultMap>

	<insert id="insertPay" >
		INSERT INTO pay(PAY_NO, 
						PAY_METHOD, 
						PAY_FEE,
						DISCOUNT_PRICE, 
						TOTAL_PRICE,
						FINAL_PRICE, 
						SAVE_POINT,
						USE_POINT) 
		VALUES ((select nvl(max(PAY_NO), 0) + 1 from pay), 
				 #{pay_method}, 
				 #{pay_fee},				 
				 #{discount_price}, 
				 #{total_price}, 
				 #{final_price}, 
				 #{save_point},
				 #{use_point}
			    )
	</insert>

	<select id="searchPay" resultMap="payList">
	<![CDATA[	
		SELECT pay_no, 
			   pay_date
		FROM   ( select * 
                 from pay 
                 order by pay_no desc
               )
        WHERE  rownum = 1
     ]]>
	</select>

	<select id="lastPayment" resultMap="payList">
		SELECT y.pay_method, 
		       y.pay_no
		FROM   pay y, 
		       orders o
		WHERE  o.user_no = ${user_no} AND
		       o.order_no = y.pay_no AND
		       rownum = 1
		order by pay_no desc		
	</select>





	
</mapper>