<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PurchaseDAO">

	<resultMap type="purchase" id="purchaselist">
		<result property="cart_no" column="PURCHASE_NO" />
		<result property="user_no" column="USER_NO" />	
		<result property="book_no" column="BOOK_NO" />	
		<result property="total_count" column="ORDER_NO" />	
		<result property="product_count" column="PRODUCT_COUNT" />	
		<collection property="userVO" resultMap="userList"></collection>		
		<collection property="bookVO" resultMap="bookList"></collection>
		<collection property="cartVO" resultMap="cartList"></collection>
	</resultMap>	

	<resultMap type="user" id="userList">
		<result property="user_no" column="USER_NO" />
	</resultMap>

	<resultMap type="book" id="bookList">
		<result property="book_no" column="BOOK_NO"/>	
	</resultMap>

	<resultMap type="cart" id="cartList">
		<result property="book_no" column="BOOK_NO"/>
		<result property="product_count" column="PRODUCT_COUNT"/>

	</resultMap>	

	<!-- user_no 수정필요 -->
	<insert id="insertPurchase">
		INSERT INTO PURCHASE (purchase_no, 
							  user_no, 
							  book_no, 
							  order_no, 
							  product_count)
		SELECT numplus.nextval, 
		       u.user_no, 
		       b.book_no, 
		       o.order_no, 
		       c.product_count
		FROM   users u, 
		       book b, 
		       cart c, 
		       orders o
		WHERE  1 = c.user_no AND b.book_no = c.book_no AND o.order_no = #{order_no}
	
	</insert>
	
	
</mapper>

